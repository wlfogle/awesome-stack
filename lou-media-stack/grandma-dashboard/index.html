<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grandma's Media Center</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: white;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
        }
        
        .header h1 {
            font-size: 3.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .header p {
            font-size: 1.5rem;
            opacity: 0.9;
        }
        
        .search-section {
            background: rgba(255,255,255,0.1);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 40px;
            backdrop-filter: blur(10px);
        }
        
        .search-box {
            display: flex;
            gap: 15px;
            align-items: center;
        }
        
        .search-input {
            flex: 1;
            padding: 20px 25px;
            font-size: 1.8rem;
            border: none;
            border-radius: 15px;
            background: rgba(255,255,255,0.9);
            color: #333;
        }
        
        .search-btn {
            padding: 20px 40px;
            font-size: 1.8rem;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .search-btn:hover {
            background: #45a049;
            transform: scale(1.05);
        }
        
        .services-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }
        
        .service-card {
            background: rgba(255,255,255,0.1);
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            transition: all 0.3s;
            backdrop-filter: blur(10px);
            cursor: pointer;
        }
        
        .service-card:hover {
            transform: translateY(-5px);
            background: rgba(255,255,255,0.2);
        }
        
        .service-icon {
            font-size: 4rem;
            margin-bottom: 20px;
        }
        
        .service-title {
            font-size: 2rem;
            margin-bottom: 10px;
        }
        
        .service-desc {
            font-size: 1.2rem;
            opacity: 0.8;
        }
        
        .results-section {
            background: rgba(255,255,255,0.1);
            border-radius: 20px;
            padding: 30px;
            backdrop-filter: blur(10px);
            display: none;
        }
        
        .result-item {
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .result-poster {
            width: 80px;
            height: 120px;
            background: rgba(255,255,255,0.2);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
        }
        
        .result-info {
            flex: 1;
        }
        
        .result-title {
            font-size: 1.8rem;
            margin-bottom: 5px;
        }
        
        .result-desc {
            font-size: 1.2rem;
            opacity: 0.8;
        }
        
        .download-btn {
            padding: 15px 30px;
            font-size: 1.4rem;
            background: #FF6B6B;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .download-btn:hover {
            background: #FF5252;
            transform: scale(1.05);
        }
        
        .status-bar {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(0,0,0,0.7);
            padding: 15px 25px;
            border-radius: 25px;
            backdrop-filter: blur(10px);
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }
        
        .spinner {
            border: 4px solid rgba(255,255,255,0.3);
            border-top: 4px solid white;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @media (max-width: 768px) {
            .header h1 { font-size: 2.5rem; }
            .search-box { flex-direction: column; }
            .services-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üé¨ Grandma's Media Center</h1>
            <p>Find and watch anything you want - just type what you're looking for!</p>
        </div>
        
        <div class="search-section">
            <div class="search-box">
                <input type="text" class="search-input" placeholder="Type what you want to watch... like 'funny movies' or 'cooking shows'" id="searchInput">
                <button class="search-btn" onclick="searchMedia()">üîç Find It!</button>
            </div>
        </div>
        
        <div class="services-grid">
            <div class="service-card" onclick="openService('http://localhost:8200')">
                <div class="service-icon">üì∫</div>
                <div class="service-title">Watch Movies & TV</div>
                <div class="service-desc">Your complete media library</div>
            </div>
            
            <div class="service-card" onclick="openService('http://localhost:8320')">
                <div class="service-icon">üì°</div>
                <div class="service-title">Live TV</div>
                <div class="service-desc">Watch and record live television</div>
            </div>
            
            <div class="service-card" onclick="openService('http://localhost:8211')">
                <div class="service-icon">üìö</div>
                <div class="service-title">Books</div>
                <div class="service-desc">Digital book library</div>
            </div>
            
            <div class="service-card" onclick="requestMedia()">
                <div class="service-icon">‚ûï</div>
                <div class="service-title">Request New Content</div>
                <div class="service-desc">Ask for movies or shows to be added</div>
            </div>
            
            <div class="service-card" onclick="openService('http://localhost:8500')">
                <div class="service-icon">‚öôÔ∏è</div>
                <div class="service-title">System Status</div>
                <div class="service-desc">Check if everything is working</div>
            </div>
            
            <div class="service-card" onclick="showHelp()">
                <div class="service-icon">‚ùì</div>
                <div class="service-title">Help & Instructions</div>
                <div class="service-desc">How to use everything</div>
            </div>
        </div>
        
        <div class="results-section" id="resultsSection">
            <h2 style="margin-bottom: 20px;">Search Results</h2>
            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>Searching for your content...</p>
            </div>
            <div id="results"></div>
        </div>
    </div>
    
    <div class="status-bar" id="statusBar">
        System Ready ‚úÖ
    </div>

    <script>
        // Global variables
        let searchTimeout;
        const API_BASE = 'http://localhost:8600/api';
        
        // Auto-search as user types
        document.getElementById('searchInput').addEventListener('input', function() {
            clearTimeout(searchTimeout);
            const query = this.value.trim();
            
            if (query.length > 2) {
                searchTimeout = setTimeout(() => searchMedia(), 1000);
            }
        });
        
        // Handle Enter key
        document.getElementById('searchInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                searchMedia();
            }
        });
        
        async function searchMedia() {
            const query = document.getElementById('searchInput').value.trim();
            if (!query) return;
            
            const resultsSection = document.getElementById('resultsSection');
            const loading = document.getElementById('loading');
            const results = document.getElementById('results');
            
            resultsSection.style.display = 'block';
            loading.style.display = 'block';
            results.innerHTML = '';
            
            updateStatus('üîç Searching...');
            
            try {
                // Real API search
                const response = await fetch(`${API_BASE}/search?q=${encodeURIComponent(query)}`);
                const data = await response.json();
                
                loading.style.display = 'none';
                
                if (!data.results || data.results.length === 0) {
                    results.innerHTML = '<p style="text-align: center; font-size: 1.5rem;">No results found. Try different keywords!</p>';
                } else {
                    results.innerHTML = data.results.map(item => `
                        <div class="result-item">
                            <div class="result-poster">${item.type === 'Movie' ? 'üé¨' : (item.type === 'TV Show' ? 'üì∫' : '‚ùì')}</div>
                            <div class="result-info">
                                <div class="result-title">${item.title}${item.year ? ` (${item.year})` : ''}</div>
                                <div class="result-desc">${item.description || 'No description available.'}</div>
                            </div>
                            <button class="download-btn" onclick="handleContent('${item.id}', '${item.service}', '${item.title.replace(/'/g, '\\&apos;')}', ${item.available})">
                                ${item.available ? '‚ñ∂Ô∏è Watch Now' : '‚¨áÔ∏è Download This'}
                            </button>
                        </div>
                    `).join('');
                }
                
                updateStatus('‚úÖ Search complete');
                
            } catch (error) {
                loading.style.display = 'none';
                results.innerHTML = '<p style="text-align: center; color: #ff6b6b;">Search failed. Please try again.</p>';
                updateStatus('‚ùå Search failed');
                console.error('Search error:', error);
            }
        }
        
        async function handleContent(id, service, title, available) {
            if (available) {
                updateStatus('‚ñ∂Ô∏è Opening player...');
                // Open media player
                window.open('http://localhost:8200', '_blank');
            } else {
                updateStatus('‚¨áÔ∏è Starting download...');
                
                try {
                    const response = await fetch(`${API_BASE}/download`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            id: id,
                            service: service,
                            title: title
                        })
                    });
                    
                    const result = await response.json();
                    
                    if (result.success) {
                        updateStatus(`‚úÖ ${title} is being downloaded!`);
                        showInstructions(title, result.estimated_time);
                    } else {
                        updateStatus('‚ùå Download failed');
                        alert(`Sorry, couldn't start the download for "${title}". ${result.error || 'Please try again later.'}`);
                    }
                } catch (error) {
                    updateStatus('‚ùå Download failed');
                    alert(`Sorry, couldn't start the download for "${title}". Please check your connection and try again.`);
                    console.error('Download error:', error);
                }
            }
        }
        
        function showInstructions(title) {
            alert(`Great! "${title}" is being downloaded.\n\nWhat happens next:\n1. The download will take 10-30 minutes\n2. You'll get a notification when it's ready\n3. It will appear in your "Watch Movies & TV" section\n4. Click the blue "Watch Movies & TV" button to find it!`);
        }
        
        function openService(url) {
            updateStatus('üöÄ Opening service...');
            window.open(url, '_blank');
        }
        
        function requestMedia() {
            const request = prompt('What movie or TV show would you like us to add?\n\nJust type the name and we\'ll try to find it for you:');
            if (request) {
                updateStatus('üìù Request submitted!');
                alert(`Thanks! We'll look for "${request}" and add it to your library soon.\n\nYou'll find it in "Watch Movies & TV" when it's ready!`);
            }
        }
        
        function showHelp() {
            alert(`How to use Grandma's Media Center:\n\nüîç SEARCH:\n‚Ä¢ Type what you want in the search box\n‚Ä¢ Use simple words like "funny movies" or "cooking shows"\n‚Ä¢ The system will find matches for you\n\n‚ñ∂Ô∏è WATCH:\n‚Ä¢ Click "Watch Movies & TV" for your main library\n‚Ä¢ Click "Live TV" to watch or record television\n‚Ä¢ Click "Books" for digital books\n\n‚¨áÔ∏è DOWNLOAD:\n‚Ä¢ Click "Download This" for new content\n‚Ä¢ Wait 10-30 minutes for it to be ready\n‚Ä¢ Find it in "Watch Movies & TV" when done\n\n‚ùì NEED HELP?\n‚Ä¢ Call your tech-savvy family member\n‚Ä¢ Everything is automatic - just click and watch!`);
        }
        
        function updateStatus(message) {
            document.getElementById('statusBar').textContent = message;
        }
        
        // Check system status on load
        window.addEventListener('load', function() {
            checkSystemStatus();
        });
        
        async function checkSystemStatus() {
            try {
                // Check if services are running
                const services = [
                    { name: 'Media Server', url: 'http://localhost:8200' },
                    { name: 'Live TV', url: 'http://localhost:8320' },
                    { name: 'Books', url: 'http://localhost:8211' }
                ];
                
                updateStatus('üîÑ Checking system...');
                
                // Mock status check
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                updateStatus('‚úÖ All systems ready!');
                
            } catch (error) {
                updateStatus('‚ö†Ô∏è Some services may be offline');
            }
        }
    </script>
</body>
</html>
